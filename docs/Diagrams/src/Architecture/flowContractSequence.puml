@startuml

title Flow Contract Sequence

actor "Initiator User" as init
entity "Initiator Account" as initAcct
actor "Member User" as member
entity "Member Account" as memberAcct
participant UI as ui
participant API as api
entity "Delphai Account" as delph
participant "Users Contract" as usersContract
participant "Bets Contract" as betsContract
participant "Resolver Contract" as resolverContract
participant "Composer Contract" as composerContract

group One time on first deployment
    delph -> usersContract : deploy
    usersContract --> delph : save token minter
    delph -> betsContract : deploy
    betsContract --> delph : save token minter
    delph -> resolverContract : deploy
    resolverContract --> delph : save token minter
    delph -> composerContract : deploy
    composerContract --> delph : save admin resource
end
group One time on user registration
    initAcct -> usersContract : saveUserTransaction
    usersContract --> initAcct : save user resource
    memberAcct -> usersContract : saveUserTransaction
    usersContract --> memberAcct : save user resource
end

init -> ui : create yes/no bet
ui -> api : create bet
api -> delph : transferTokens\nTransaction
delph --> initAcct : transfer bet tokens
delph --> memberAcct : transfer bet tokens
delph -> delph : createBetTransaction
api --> ui : response

ui -> delph : placeBetTransaction
initAcct --> delph : transfer bet token
ui --> init : show result
member -> ui : make bet
ui -> delph : placeBetTransaction
memberAcct --> delph : transfer bet token

-> delph : bet closes

init -> ui : vote to resolve
ui -> delph : voteToResolveTransaction
initAcct --> delph : transfer resolution token
ui --> init : show result
member -> ui : vote to resolve
ui -> delph : voteToResolveTransaction
memberAcct --> delph : transfer resolution token
delph -> api : raise BetResolved\nevent
ui --> member : show result

init -> ui : claim pot
ui -> delph : retrievePotTransaction
initAcct --> delph : transfer claim token
delph --> initAcct : transfer money
member -> ui : claim pot
ui -> delph : retrievePotTransaction
memberAcct --> delph : transfer claim token
delph --> memberAcct : transfer money

@enduml