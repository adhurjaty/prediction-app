@startuml Registration Sequence

title Registration Sequence

actor User as user
participant UI as ui
database "Local Store" as localstore
participant "API Backend" as api
database Database as db
participant "OAuth Provider" as oauth
participant "Testnet Faucet" as faucet

user -> ui : Click register 

group OAuth
    ui -> api : Create user endpoint
    api -> oauth : Register user
    oauth -> api : Return user info
    api -> db: Check if user exists
    db -> api: Return if user exists
    api -> ui: Login (if exists)
    api -> db : Insert user (if user does not exist)
    api -> ui : Report oauth success/failure
end

group Prestige Wallet
    ui -> ui : Generate testnet ETH wallet (rETH)
    ui -> localstore : Store wallet address and key
    ui -> api : Store wallet address and key
    api -> db : Store wallet address and key
    api -> faucet : Get ETH for wallet
    api -> ui : Show success/error page
end

group Ethereum Wallet
    ui -> user : Display message with pointers to learn more about real \nmoney wallets and suggest skipping for now
    ui -> user : Prompt user to create wallet, import wallet, \nor skip for now
else Skip wallet settings for now
    user -> ui : Press skip button
else Import existing wallet
    user -> ui : Press import button
    user -> ui : Selects 3rd party wallet or private key

    group Wallet Import [3rd party]
        ui -> ui : Retrieve private key from 3rd party
    else Private key
        ui -> user : Prompt user for import from file or manual entry 
        user -> ui : Provides private key in some fashion
        ui -> ui : Create wallet from private key (via ethers.js)
    end

    ui -> localstore : Store wallet address and key

    ui -> api : Store wallet address 
    api -> db : Store wallet address 
else Create new wallet
    user -> ui : Press create button
    ui -> ui : Create wallet (via ethers.js)
    ui -> user : Instructions to back up private key
    ui -> localstore : Store wallet address and key
    ui -> api : Store wallet address 
    api -> db : Store wallet address 
end

ui -> user : Registration complete

@enduml