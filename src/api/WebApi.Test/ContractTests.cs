using System;
using System.IO;
using Xunit;
using FluentAssertions;
using WebApi;

namespace WebApi.Test
{
    public class ContractTests
    {
        private static string OBJECTS_PATH = @"Objects";

        [Fact]
        public void CreateMultipleContractInfo()
        {
            string json = File.ReadAllText(Path.Combine(OBJECTS_PATH, "combined.json"));
            var factory = new ContractFactory(new BlockchainSettings(),
                json);
            
            var info = factory.GetContractInfo("EqualAnteProposition");

            info.Should().BeEquivalentTo(new DeployableContractInfo()
            {
                Abi = "[{\"inputs\":[{\"internalType\":\"string\",\"name\":\"_title\",\"type\":\"string\"},{\"internalType\":\"uint256\",\"name\":\"_resolution_time\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"_bet_closing_time\",\"type\":\"uint256\"}],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"newMember\",\"type\":\"address\"}],\"name\":\"addMember\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"bet_closing_time\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"account\",\"type\":\"address\"}],\"name\":\"checkMembership\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"getMyBet\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"pool\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"resolution_time\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"title\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"wager\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"wager\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]",
                Bin = "60806040523480156200001157600080fd5b5060405162000e3b38038062000e3b8339818101604052810190620000379190620001fd565b82828260016000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055508260039080519060200190620000a9929190620000c4565b50816005819055508060048190555050505050505062000400565b828054620000d2906200030b565b90600052602060002090601f016020900481019282620000f6576000855562000142565b82601f106200011157805160ff191683800117855562000142565b8280016001018555821562000142579182015b828111156200014157825182559160200191906001019062000124565b5b50905062000151919062000155565b5090565b5b808211156200017057600081600090555060010162000156565b5090565b60006200018b620001858462000295565b6200026c565b905082815260208101848484011115620001a457600080fd5b620001b1848285620002d5565b509392505050565b600082601f830112620001cb57600080fd5b8151620001dd84826020860162000174565b91505092915050565b600081519050620001f781620003e6565b92915050565b6000806000606084860312156200021357600080fd5b600084015167ffffffffffffffff8111156200022e57600080fd5b6200023c86828701620001b9565b93505060206200024f86828701620001e6565b92505060406200026286828701620001e6565b9150509250925092565b6000620002786200028b565b905062000286828262000341565b919050565b6000604051905090565b600067ffffffffffffffff821115620002b357620002b2620003a6565b5b620002be82620003d5565b9050602081019050919050565b6000819050919050565b60005b83811015620002f5578082015181840152602081019050620002d8565b8381111562000305576000848401525b50505050565b600060028204905060018216806200032457607f821691505b602082108114156200033b576200033a62000377565b5b50919050565b6200034c82620003d5565b810181811067ffffffffffffffff821117156200036e576200036d620003a6565b5b80604052505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6000601f19601f8301169050919050565b620003f181620002cb565b8114620003fd57600080fd5b50565b610a2b80620004106000396000f3fe608060405234801561001057600080fd5b50600436106100935760003560e01c8063667d5d2211610066578063667d5d2214610122578063b24b05f81461012c578063b76b0b991461014a578063ca6d56dc14610166578063eb074d781461018257610093565b806316f0115b14610098578063441cfe02146100b65780634a79d50c146100d45780635fb64fd6146100f2575b600080fd5b6100a06101a0565b6040516100ad91906107a6565b60405180910390f35b6100be6101a6565b6040516100cb91906107a6565b60405180910390f35b6100dc6101ac565b6040516100e99190610744565b60405180910390f35b61010c6004803603810190610107919061063a565b61023a565b6040516101199190610729565b60405180910390f35b61012a61028f565b005b61013461037a565b60405161014191906107a6565b60405180910390f35b610164600480360381019061015f9190610663565b61044c565b005b610180600480360381019061017b919061063a565b610525565b005b61018a61060a565b60405161019791906107a6565b60405180910390f35b60025481565b60055481565b600380546101b9906108ae565b80601f01602080910402602001604051908101604052809291908181526020018280546101e5906108ae565b80156102325780601f1061020757610100808354040283529160200191610232565b820191906000526020600020905b81548152906001019060200180831161021557829003601f168201915b505050505081565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff169050919050565b6000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff1661031a576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161031190610786565b60405180910390fd5b60018060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555060016002600082825461037191906107dd565b92505081905550565b60008060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16610407576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103fe90610786565b60405180910390fd5b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905090565b6000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff166104d7576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016104ce90610786565b60405180910390fd5b6001811461051a576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161051190610766565b60405180910390fd5b61052261028f565b50565b6000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff166105b0576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016105a790610786565b60405180910390fd5b60016000808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff02191690831515021790555050565b60045481565b60008135905061061f816109c7565b92915050565b600081359050610634816109de565b92915050565b60006020828403121561064c57600080fd5b600061065a84828501610610565b91505092915050565b60006020828403121561067557600080fd5b600061068384828501610625565b91505092915050565b61069581610845565b82525050565b60006106a6826107c1565b6106b081856107cc565b93506106c081856020860161087b565b6106c98161093e565b840191505092915050565b60006106e16035836107cc565b91506106ec8261094f565b604082019050919050565b60006107046016836107cc565b915061070f8261099e565b602082019050919050565b61072381610871565b82525050565b600060208201905061073e600083018461068c565b92915050565b6000602082019050818103600083015261075e818461069b565b905092915050565b6000602082019050818103600083015261077f816106d4565b9050919050565b6000602082019050818103600083015261079f816106f7565b9050919050565b60006020820190506107bb600083018461071a565b92915050565b600081519050919050565b600082825260208201905092915050565b60006107e882610871565b91506107f383610871565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff03821115610828576108276108e0565b5b828201905092915050565b600061083e82610851565b9050919050565b60008115159050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b60005b8381101561089957808201518184015260208101905061087e565b838111156108a8576000848401525b50505050565b600060028204905060018216806108c657607f821691505b602082108114156108da576108d961090f565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000601f19601f8301169050919050565b7f43616e6e6f74207761676572206d6f7265207468616e203120696e20616e206560008201527f7175616c20616e74652070726f706f736974696f6e0000000000000000000000602082015250565b7f43616c6c6572206973206e6f742061206d656d62657200000000000000000000600082015250565b6109d081610833565b81146109db57600080fd5b50565b6109e781610871565b81146109f257600080fd5b5056fea2646970667358221220cd87ff829b227a0dc7e9c8956f5e668e470f707bd94fe50b446d8a2c301a53c564736f6c63430008030033"
            });
        }
    }
}
